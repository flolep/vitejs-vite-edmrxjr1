{
  "name": "Blindtest Game - Generate Wrong Answers v1.0",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "blindtest-wrong-answers",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-wrong-answers",
      "name": "Wrong Answers Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [0, 300],
      "webhookId": "wrong-answers-webhook-id"
    },
    {
      "parameters": {
        "jsCode": "// Parse the webhook body\nconst input = $json.body;\n\nconsole.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');\nconsole.log('ðŸŽµ Wrong Answers Generator - Start');\nconsole.log('Type du body:', typeof input);\n\nlet data;\n\n// Parse body (object or JSON string)\nif (typeof input === 'object' && input !== null) {\n  console.log('âœ… Body dÃ©jÃ  parsÃ© comme objet');\n  data = input;\n} else if (typeof input === 'string') {\n  console.log('ðŸ”„ Body est une string, parsing nÃ©cessaire');\n  try {\n    data = JSON.parse(input);\n    console.log('âœ… Parsing JSON rÃ©ussi');\n  } catch (e) {\n    console.log('âŒ Erreur parsing:', e.message);\n    throw new Error(`Impossible de parser le JSON: ${e.message}`);\n  }\n} else {\n  throw new Error(`Type de body inattendu: ${typeof input}`);\n}\n\n// Validation\nif (!Array.isArray(data.songs)) {\n  throw new Error('songs doit Ãªtre un array');\n}\n\nif (data.songs.length === 0) {\n  throw new Error('songs array est vide');\n}\n\nconsole.log(`âœ… Received ${data.songs.length} songs`);\nconsole.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');\n\nreturn [{ json: data }];"
      },
      "id": "parse-json-body",
      "name": "Parse JSON Body",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [224, 300]
    },
    {
      "parameters": {
        "jsCode": "// Split songs into individual items for parallel processing\nconst songs = $json.songs;\n\nconsole.log(`ðŸ”€ Splitting ${songs.length} songs for parallel wrong answers generation`);\n\nreturn songs.map((song, index) => ({\n  json: {\n    index: index,\n    artist: song.artist,\n    title: song.title || song.song,\n    uri: song.uri\n  }\n}));"
      },
      "id": "split-songs",
      "name": "Split Songs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [448, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "wrong-answers-prompt",
              "name": "wrongAnswersPrompt",
              "type": "string",
              "value": "=For this song, generate 3 WRONG answers for a music quiz. The wrong answers must be:\n\nCorrect answer: {{ $json.artist }} - {{ $json.title }}\n\nRules:\n- 3 real, well-known songs from the SAME or SIMILAR genre\n- Same musical era (Â±5 years if possible)\n- Comparable popularity level\n- Format: \"Artist - Song Title\"\n- DO NOT repeat the correct answer\n- Make them credible but clearly different songs\n\nRESPOND WITH ONLY VALID JSON in this exact format:\n[\"Artist 1 - Song Title 1\", \"Artist 2 - Song Title 2\", \"Artist 3 - Song Title 3\"]\n\nNo markdown, no explanations, just the JSON array."
            }
          ]
        },
        "options": {}
      },
      "id": "format-prompt",
      "name": "Format Wrong Answers Prompt",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [672, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.wrongAnswersPrompt }}",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [896, 300],
      "id": "ai-generate-wrong-answers",
      "name": "AI Generate Wrong Answers",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-3.5-turbo",
          "mode": "list",
          "cachedResultName": "gpt-3.5-turbo"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [800, 540],
      "id": "openai-model",
      "name": "OpenAI Chat Model (GPT-3.5)",
      "credentials": {
        "openAiApi": {
          "id": "ytGgzcq7Rtx4z7WA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse wrong answers from AI response\nconst wrongAnswersResponse = $input.item.json;\nconst songData = $node['Split Songs'].item.json;\n\nconsole.log(`ðŸŽ¯ [${songData.index}] Parsing wrong answers for: ${songData.title}`);\n\nlet wrongAnswers = wrongAnswersResponse;\n\n// Handle different response formats\nif (typeof wrongAnswers === 'string') {\n  wrongAnswers = JSON.parse(wrongAnswers);\n} else if (wrongAnswers.output) {\n  wrongAnswers = typeof wrongAnswers.output === 'string' \n    ? JSON.parse(wrongAnswers.output) \n    : wrongAnswers.output;\n} else if (wrongAnswers.text) {\n  wrongAnswers = typeof wrongAnswers.text === 'string' \n    ? JSON.parse(wrongAnswers.text) \n    : wrongAnswers.text;\n}\n\n// Ensure we have exactly 3 wrong answers\nif (!Array.isArray(wrongAnswers) || wrongAnswers.length < 3) {\n  console.warn(`  âš ï¸ Invalid wrong answers for song ${songData.index}, using fallback`);\n  wrongAnswers = [\n    `Unknown Artist 1 - Song ${songData.index + 1}A`,\n    `Unknown Artist 2 - Song ${songData.index + 1}B`,\n    `Unknown Artist 3 - Song ${songData.index + 1}C`\n  ];\n}\n\nwrongAnswers = wrongAnswers.slice(0, 3);\n\nconsole.log(`  âœ“ Wrong answers:`, wrongAnswers);\n\nreturn [{\n  json: {\n    index: songData.index,\n    artist: songData.artist,\n    title: songData.title,\n    uri: songData.uri,\n    wrongAnswers: wrongAnswers\n  }\n}];"
      },
      "id": "parse-wrong-answers",
      "name": "Parse Wrong Answers",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "jsCode": "// Aggregate all wrong answers into a map indexed by song index\nconst allItems = $input.all();\nconst wrongAnswersMap = {};\n\nconsole.log('ðŸ”€ Aggregating wrong answers...');\n\nfor (const item of allItems) {\n  const data = item.json;\n  \n  wrongAnswersMap[data.index] = {\n    artist: data.artist,\n    title: data.title,\n    uri: data.uri,\n    wrongAnswers: data.wrongAnswers\n  };\n  \n  console.log(`  âœ“ [${data.index}] ${data.title} - ${data.wrongAnswers.length} wrong answers`);\n}\n\nconst totalSongs = Object.keys(wrongAnswersMap).length;\n\nif (totalSongs === 0) {\n  throw new Error('No wrong answers generated');\n}\n\nconsole.log(`âœ… Successfully generated wrong answers for ${totalSongs} songs`);\n\nreturn [{\n  json: {\n    success: true,\n    totalSongs: totalSongs,\n    wrongAnswers: wrongAnswersMap\n  }\n}];"
      },
      "id": "aggregate-results",
      "name": "Aggregate Wrong Answers",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1344, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "send-response",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1568, 300]
    }
  ],
  "pinData": {},
  "connections": {
    "Wrong Answers Webhook": {
      "main": [[{"node": "Parse JSON Body", "type": "main", "index": 0}]]
    },
    "Parse JSON Body": {
      "main": [[{"node": "Split Songs", "type": "main", "index": 0}]]
    },
    "Split Songs": {
      "main": [[{"node": "Format Wrong Answers Prompt", "type": "main", "index": 0}]]
    },
    "Format Wrong Answers Prompt": {
      "main": [[{"node": "AI Generate Wrong Answers", "type": "main", "index": 0}]]
    },
    "AI Generate Wrong Answers": {
      "main": [[{"node": "Parse Wrong Answers", "type": "main", "index": 0}]]
    },
    "OpenAI Chat Model (GPT-3.5)": {
      "ai_languageModel": [[{"node": "AI Generate Wrong Answers", "type": "ai_languageModel", "index": 0}]]
    },
    "Parse Wrong Answers": {
      "main": [[{"node": "Aggregate Wrong Answers", "type": "main", "index": 0}]]
    },
    "Aggregate Wrong Answers": {
      "main": [[{"node": "Send Response", "type": "main", "index": 0}]]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "wrong-answers-v1.0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "94b9168551008d33a984c826b7246a9b011ffc20d1040c638e77929747a45f99"
  },
  "id": "WrongAnswersGenerator",
  "tags": [
    {
      "createdAt": "2025-10-12T08:27:32.015Z",
      "updatedAt": "2025-10-12T08:27:32.015Z",
      "id": "pestZUqJUXuCf3nU",
      "name": "BlindTest"
    }
  ]
}
